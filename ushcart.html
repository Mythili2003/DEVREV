<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="cartss.js"></script>
    <style>
.book-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  grid-gap: 20px;
}
.book-container {
  position: relative;
}
.book-cover {
  width: 100%;
  height: 100%;
  object-fit: cover;
}
.book-details {
  display: none;
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.8);
  color: #fff;
  font-size: larger;
  padding: 20px;
  box-sizing: border-box;
}
.book-container:hover .book-details {
  display: flex;
  flex-direction: column;
  /* align-items: center; */
  justify-content: center;
}
.book-details p {
  margin: 5px 0;
}
.add-to-cart {
  margin-top: 10px;
  padding: 10px 0px;
  border-radius: 50px;
  background-color: #007bff;
  color: #fff;
  border: none;
  cursor: pointer;
}
.cart-icon {
  position: absolute;
  top: 40px;
  right: 10px;
  font-size: 24px;
  color: #007bff;
  cursor: pointer;
}
.cart-items {
  position: absolute;
  z-index: 1;
  top: 70px;
  right: 10px;
  background-color: #fff;
  padding: 10px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  max-width: 300px;
  overflow-y: auto;
  max-height: 300px;
  display: none;
}
.cart-item {
  margin-bottom: 10px;
}
.cart-item p {
  margin: 5px 0;
}
.remove-from-cart {
  margin-top: 5px;
  padding:10px 10px;
  border-radius: 50px;
  background-color: #dc3545;
  color: #fff;
  border: none;
  cursor: pointer;
}
</style>
<script>
    const cartItems = [];

// Fetch book data from Open Library API
fetch('https://openlibrary.org/subjects/computer_science.json?limit=50')
    .then(response => response.json())
    .then(data => {
        displayBooks(data);
    })
    .catch(error => {
        console.error('Error:', error);
    });

// Display books on the page
function displayBooks(data) {
    const bookList = document.getElementById('bookList');

    data.works.forEach(work => {
        const book = work.cover_edition_key;
        const title = work.title;
        const author = work.authors[0]?.name || 'Unknown';
        
        const year = work.first_publish_year ? work.first_publish_year : 'Unknown';
        const availableCopies = getRandomNumber(0, 10);

        const bookContainer = document.createElement('div');
        bookContainer.className = 'book-container';

        // Create book cover element
        const bookCover = document.createElement('img');
        bookCover.className = 'book-cover';
        bookCover.src = `https://covers.openlibrary.org/b/olid/${book}-M.jpg`;

        // Create book details element
        const bookDetails = document.createElement('div');
        bookDetails.className = 'book-details';
        bookDetails.innerHTML = `
            <p><strong>Title:</strong> ${title}</p>
            <p><strong>Author:</strong> ${author}</p>
            <p><strong>Year:</strong> ${year}</p>
            <p><strong>Available Copies:</strong> ${availableCopies}</p>
            <button class="add-to-cart" onclick="addToCart('${book}', '${title}', '${author}', ${availableCopies})">Add to Cart</button>
        `;

        bookContainer.appendChild(bookCover);
        bookContainer.appendChild(bookDetails);
        bookList.appendChild(bookContainer);
    });
}

// Generate a random number between min (inclusive) and max (inclusive)
function getRandomNumber(min, max) {
    return Math.floor(Math.random() * (max - min + 1) + min);
}

// Add a book to the cart
function addToCart(book, title, author, availableCopies) {
if (availableCopies === 0) {
alert('No copies available in the library!');
return;
}

cartItems.push({ book, title, author });
availableCopies--;

updateCartItems();
updateAvailableCopies(book, availableCopies);
updateCartCount(); // Update the cart count
}
// Remove a book from the cart
function removeFromCart(index) {
const removedItem = cartItems.splice(index, 1)[0];
updateCartItems();
updateAvailableCopies(removedItem.book, 1);
updateCartCount(); // Update the cart count
}

// Update the cart items
function updateCartItems() {
    const cartItemsElement = document.getElementById('cartItems');
    cartItemsElement.innerHTML = '';

    cartItems.forEach((item, index) => {
        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
            <p><strong>Title:</strong> ${item.title}</p>
            <p><strong>Author:</strong> ${item.author}</p>
            <button class="remove-from-cart" onclick="removeFromCart(${index})">Remove from Cart</button>
        `;
        cartItemsElement.appendChild(cartItem);
    });
}

// Update the available copies for a book
function updateAvailableCopies(book, availableCopies) {
    const bookContainers = document.getElementsByClassName('book-container');
    Array.from(bookContainers).forEach(container => {
        const coverEditionKey = container.querySelector('.book-cover').src.split('/').pop().split('-')[0];
        if (coverEditionKey === book) {
            container.querySelector('.book-details p:last-child').textContent = `Available Copies: ${availableCopies}`;
        }
    });
}

function updateCartCount() {
  const cartCount = document.getElementById('cartCount');
  if (cartCount) {
    cartCount.innerHTML = `<p>${cartItems.length}</p>`;
  }
}

// Toggle the visibility of the cart items
function toggleCart() {
    const cartItemsElement = document.getElementById('cartItems');
    cartItemsElement.style.display = cartItemsElement.style.display === 'none' ? 'block' : 'none';
}
</script>
</head>
<body>
    <div id="bookList" class="book-grid"></div>
       <div class="cart-icon" id="cartIcon" onclick="toggleCart()"><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTWX3MGbr3TnrQNTGCHKkA4VRRNR1hx9OuWgBNe9LLOUBjVuQ_2tKdEdacZWRr8HUQYg7s&usqp=CAU" alt="" height="30px"><span id="cartCount"></span></div>
        <div id="cartItems" class="cart-items"></div>
</body>
</html>